@{
    ViewData["Title"] = "Xác thực hai yếu tố";
    Layout = "_AuthLayout";
}

<div class="max-w-sm mx-auto bg-white border border-slate-200 rounded-lg p-6 shadow-sm text-sm font-sans">
    <h1 class="text-xl font-semibold text-slate-900 mb-3 text-center">Nhập mã xác thực</h1>
    <p class="text-slate-600 mb-4 text-center">
        Mở ứng dụng xác thực của bạn (Google/Microsoft Authenticator) và nhập mã 6 chữ số.
    </p>

    @if (ViewBag.Info != null)
    {
        <div class="mb-3 rounded-md border border-blue-200 bg-blue-50 px-3 py-2 text-xs text-blue-700">
            @ViewBag.Info
        </div>
    }

    @if (ViewBag.Error != null)
    {
        <div class="mb-3 rounded-md border border-red-200 bg-red-50 px-3 py-2 text-xs text-red-700">
            @ViewBag.Error
        </div>
    }

    <form method="post" asp-action="VerifyAuthenticatorCode" class="space-y-4">
        @Html.AntiForgeryToken()

        <div>
            <label class="block text-slate-700 mb-2 font-medium text-center">Mã xác thực</label>
            <input name="code"
                   type="text"
                   maxlength="6"
                   pattern="[0-9]{6}"
                   required
                   autofocus
                   autocomplete="one-time-code"
                   placeholder="000000"
                   class="w-full rounded-md border border-slate-200 px-3 py-2 text-center text-2xl font-mono focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                   style="letter-spacing: 0.5em;" />
            <p class="text-xs text-slate-500 mt-2 text-center">Mã sẽ thay đổi mỗi 30 giây</p>
        </div>

        <button type="submit"
                class="w-full rounded-md bg-blue-600 text-white py-2 font-medium hover:bg-blue-700 transition-colors shadow-sm">
            Xác nhận
        </button>
    </form>

    <div class="mt-6 pt-4 border-t border-slate-200">
        <p class="text-xs text-slate-600 mb-2">
            <strong>Mẹo:</strong> Nếu mã không hoạt động:
        </p>
        <ul class="text-xs text-slate-500 space-y-1 ml-4 list-disc">
            <li>Đảm bảo thời gian trên điện thoại chính xác</li>
            <li>Đợi mã mới được tạo (mỗi 30 giây)</li>
            <li>Kiểm tra bạn đang dùng đúng tài khoản trong app</li>
        </ul>
    </div>

    <p class="text-xs text-slate-500 mt-4 text-center">
        Mất quyền truy cập vào app?
        <a asp-action="Login" class="text-blue-600 hover:underline font-medium">Đăng nhập lại</a>
    </p>
</div>

<script>
    document.querySelector('input[name="code"]').addEventListener('input', function(e) {
        var value = e.target.value.replace(/\D/g, '');
        e.target.value = value;
        if (value.length === 6) {
            setTimeout(() => e.target.form.submit(), 200);
        }
    });
</script>