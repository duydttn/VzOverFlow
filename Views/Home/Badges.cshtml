@model VzOverFlow.Models.ViewModels.BadgePageViewModel
@{
    ViewData["Title"] = "Huy hiệu";
}

<div class="mb-6 flex items-start justify-between gap-4">
    <div>
        <h1 class="text-2xl md:text-3xl font-semibold text-slate-900 mb-1">
            Bảng huy hiệu của bạn
        </h1>
        <p class="text-sm text-slate-600">
            Hoàn thành các mốc đóng góp để mở khoá huy hiệu và nhận XP thưởng.
        </p>
    </div>
</div>

@if (Model.RequiresLogin)
{
    <div class="bg-white border border-slate-200 rounded-lg p-6 shadow-sm text-center text-sm text-slate-600">
        <p class="mb-3">
            Đăng nhập để xem tiến độ huy hiệu cá nhân.
        </p>
        <div class="flex justify-center gap-2 text-xs">
            <a asp-controller="Users" asp-action="Login"
               class="rounded-md border border-slate-200 px-4 py-2 hover:bg-slate-50">
                Đăng nhập
            </a>
            <a asp-controller="Users" asp-action="Register"
               class="rounded-md bg-slate-900 text-white px-4 py-2 hover:bg-slate-800">
                Tạo tài khoản
            </a>
        </div>
    </div>
}
else
{
    <div class="mb-4 text-xs text-slate-500">
        Xin chúc mừng <span class="font-semibold">@Model.UserName</span>! Dưới đây là tiến độ huy hiệu của bạn.
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        @foreach (var badge in Model.Badges)
        {
            var borderClass = badge.Tier.Contains("🥇") ? "border-yellow-300" :
                              badge.Tier.Contains("🥈") ? "border-slate-200" : "border-amber-200";
            <section class="bg-white border @borderClass rounded-lg p-4 shadow-sm text-xs">
                <div class="flex items-center justify-between mb-2">
                    <div>
                        <h2 class="text-sm font-semibold text-slate-900">@badge.Tier - @badge.Name</h2>
                        <p class="text-slate-600">@badge.Description</p>
                    </div>
                    <div class="text-right">
                        <div class="text-[11px] text-slate-500">Thưởng</div>
                        <div class="text-slate-900 font-semibold">+@badge.RewardXp XP</div>
                    </div>
                </div>
                <div class="h-1.5 rounded-full bg-slate-100 overflow-hidden mb-2">
                    <div class="h-full @(badge.Achieved ? "bg-emerald-500" : "bg-blue-400")"
                         style="width:@(badge.Completion * 100)%"></div>
                </div>
                <div class="flex items-center justify-between text-[11px] text-slate-500">
                    <span>Tiến độ: @badge.Progress/@badge.Target</span>
                    <span>@(badge.Achieved ? "Đã mở khoá" : $"Cần {badge.Target - badge.Progress} nữa")</span>
                </div>
            </section>
        }
    </div>
}
